{% extends "layout.html" %}

{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - Workers System{% endblock %}

{% block page_content %}
<div class="page-header">
    <div>
        <h1 class="page-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
    </div>
</div>

<!-- Filters -->
<div class="filters">
    <a href="/users" class="filter-button {% if not current_filter or current_filter == 'all' %}active{% endif %}">
        –í—Å–µ
    </a>
    <a href="/users?role=worker" class="filter-button {% if current_filter == 'worker' %}active{% endif %}">
        –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
    </a>
    <a href="/users?role=client" class="filter-button {% if current_filter == 'client' %}active{% endif %}">
        –ó–∞–∫–∞–∑—á–∏–∫–∏
    </a>
    <a href="/users?role=admin" class="filter-button {% if current_filter == 'admin' %}active{% endif %}">
        –ê–¥–º–∏–Ω—ã
    </a>
    <a href="/users?role=moderator" class="filter-button {% if current_filter == 'moderator' %}active{% endif %}">
        –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã
    </a>
</div>

<!-- Users List -->
{% if users %}
<div style="margin-bottom: 16px; color: #6b7280; font-size: 0.875rem;">
    –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ users|length }}
</div>

{% for user in users %}
<div class="card">
    <div class="card-header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 48px; height: 48px; border-radius: 50%; background-color: #f3f4f6; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                {% if user.role == 'worker' %}üîß{% elif user.role == 'client' %}üë§{% elif user.role == 'admin' %}üëë{% else %}‚öôÔ∏è{% endif %}
            </div>
            <div>
                <h3 class="card-title">{{ user.first_name or '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π' }} {{ user.last_name or '' }}</h3>
                <p style="margin: 2px 0 0 0; font-size: 0.875rem; color: #6b7280;">
                    @{{ user.username or 'no_username' }}
                </p>
            </div>
        </div>
        
        <div style="display: flex; align-items: center; gap: 8px;">
            {% set role_info = {
                'worker': {'label': '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', 'color': '#10b981'},
                'client': {'label': '–ó–∞–∫–∞–∑—á–∏–∫', 'color': '#3b82f6'},
                'admin': {'label': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'color': '#ef4444'},
                'moderator': {'label': '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä', 'color': '#f59e0b'}
            }.get(user.role, {'label': user.role, 'color': '#6b7280'}) %}
            
            <span style="padding: 4px 12px; border-radius: 9999px; font-size: 0.75rem; font-weight: bold; background-color: {{ role_info.color }}20; color: {{ role_info.color }};">
                {{ role_info.label }}
            </span>
            
            {% if user.is_verified %}
            <span style="padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; background-color: #10b98120; color: #059669;">
                ‚úì –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
            </span>
            {% endif %}
            
            {% if not user.is_active %}
            <span style="padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; background-color: #ef444420; color: #dc2626;">
                –ù–µ–∞–∫—Ç–∏–≤–µ–Ω
            </span>
            {% endif %}
        </div>
    </div>

    <div class="grid grid-3" style="margin-bottom: 16px;">
        <div>
            <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">TELEGRAM ID</span>
            <div style="font-size: 0.875rem; color: #374151;">{{ user.tg_chat_id }}</div>
        </div>
        
        {% if user.phone %}
        <div>
            <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–¢–ï–õ–ï–§–û–ù</span>
            <div style="font-size: 0.875rem; color: #374151;">{{ user.phone }}</div>
        </div>
        {% endif %}
        
        <div>
            <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</span>
            <div style="font-size: 0.875rem; color: #374151;">{{ user.created_at | format_date }}</div>
        </div>
    </div>

    {% if user.role == 'worker' and user.worker_profile %}
    <div style="padding-top: 16px; border-top: 1px solid #f3f4f6;">
        <div class="grid grid-3" style="margin-bottom: 12px;">
            <div>
                <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–†–ï–ô–¢–ò–ù–ì</span>
                <div style="font-size: 0.875rem; color: #374151;">
                    ‚≠ê {{ "%.1f"|format(user.worker_profile.rating) }}
                </div>
            </div>
            <div>
                <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–í–´–ü–û–õ–ù–ï–ù–û</span>
                <div style="font-size: 0.875rem; color: #374151;">
                    {{ user.worker_profile.completed_tasks }} –∑–∞–¥–∞—á
                </div>
            </div>
            <div>
                <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–û–¢–ú–ï–ù–ï–ù–û</span>
                <div style="font-size: 0.875rem; color: #374151;">
                    {{ user.worker_profile.cancelled_tasks }} –∑–∞–¥–∞—á
                </div>
            </div>
        </div>
        
        {% if user.worker_profile.worker_types %}
        <div style="margin-top: 12px;">
            <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–°–ü–ï–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò</span>
            <div style="margin-top: 4px;">
                {% for worker_type in user.worker_profile.worker_types %}
                <span style="display: inline-block; margin: 2px 8px 2px 0; padding: 2px 8px; background-color: #f3f4f6; border-radius: 4px; font-size: 0.75rem; color: #374151;">
                    {% if worker_type == 'loader' %}–ì—Ä—É–∑—á–∏–∫{% elif worker_type == 'driver' %}–í–æ–¥–∏—Ç–µ–ª—å{% elif worker_type == 'rigger' %}–¢–∞–∫–µ–ª–∞–∂–Ω–∏–∫{% elif worker_type == 'cleaner' %}–£–±–æ—Ä—â–∏–∫{% else %}–†–∞–∑–Ω–æ—Ä–∞–±–æ—á–∏–π{% endif %}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if user.worker_profile.on_vacation %}
        <div style="margin-top: 12px; padding: 8px 12px; background-color: #fef3c7; border-radius: 6px; font-size: 0.875rem; color: #92400e;">
            üèñÔ∏è –í –æ—Ç–ø—É—Å–∫–µ –¥–æ {{ user.worker_profile.vacation_end | format_date if user.worker_profile.vacation_end else '–Ω–µ —É–∫–∞–∑–∞–Ω–æ' }}
        </div>
        {% endif %}
    </div>
    {% endif %}

    {% if user.role == 'client' and user.client_profile %}
    <div style="padding-top: 16px; border-top: 1px solid #f3f4f6;">
        <div class="grid grid-4">
            {% if user.client_profile.company_name %}
            <div>
                <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–ö–û–ú–ü–ê–ù–ò–Ø</span>
                <div style="font-size: 0.875rem; color: #374151;">
                    {{ user.client_profile.company_name }}
                </div>
            </div>
            {% endif %}
            <div>
                <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–†–ï–ô–¢–ò–ù–ì</span>
                <div style="font-size: 0.875rem; color: #374151;">
                    ‚≠ê {{ "%.1f"|format(user.client_profile.rating) }}
                </div>
            </div>
            <div>
                <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–ó–ê–ö–ê–ó–û–í</span>
                <div style="font-size: 0.875rem; color: #374151;">
                    {{ user.client_profile.total_orders }}
                </div>
            </div>
            <div>
                <span style="font-size: 0.75rem; color: #9ca3af; font-weight: 600;">–ü–û–¢–†–ê–ß–ï–ù–û</span>
                <div style="font-size: 0.875rem; color: #374151;">
                    {{ user.client_profile.total_spent | format_currency }}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endfor %}

{% else %}
<div class="empty-state">
    <div class="empty-state-icon">üë•</div>
    <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
    <p>
        {% if current_filter and current_filter != 'all' %}
            –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é "{{ current_filter }}"
        {% else %}
            –í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        {% endif %}
    </p>
</div>
{% endif %}
{% endblock %}