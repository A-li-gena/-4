{% extends "layout.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - Workers System{% endblock %}

{% block page_content %}
<div class="page-header">
    <div>
        <h1 class="page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
        <p class="page-subtitle">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã</p>
    </div>
    <button onclick="checkHealth()" class="button button-primary" id="checkHealthBtn">
        <span>üîÑ</span>
        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
    </button>
</div>

<!-- Health Status -->
<div class="card">
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
        <span style="font-size: 1.5rem;">‚öôÔ∏è</span>
        <h2 style="margin: 0; font-size: 1.25rem; font-weight: bold; color: #1f2937;">
            –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
        </h2>
    </div>

    <div id="healthStatus">
        {% if health %}
        <div style="display: flex; flex-direction: column; gap: 16px;">
            <!-- Backend Status -->
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background-color: #f9fafb; border-radius: 6px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.25rem;">üñ•Ô∏è</span>
                    <div>
                        <div style="font-weight: 500; color: #1f2937;">Backend API</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">FastAPI —Å–µ—Ä–≤–µ—Ä</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 1.25rem;">{{ '‚úÖ' if health.ok else '‚ùå' }}</span>
                    <span style="font-weight: 500; color: {{ '#059669' if health.ok else '#dc2626' }};">
                        {{ '–†–∞–±–æ—Ç–∞–µ—Ç' if health.ok else '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ' }}
                    </span>
                </div>
            </div>

            <!-- Database Status -->
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background-color: #f9fafb; border-radius: 6px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.25rem;">üóÑÔ∏è</span>
                    <div>
                        <div style="font-weight: 500; color: #1f2937;">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">MongoDB</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 1.25rem;">{{ '‚úÖ' if health.db_connected else '‚ùå' }}</span>
                    <span style="font-weight: 500; color: {{ '#059669' if health.db_connected else '#dc2626' }};">
                        {{ '–†–∞–±–æ—Ç–∞–µ—Ç' if health.db_connected else '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ' }}
                    </span>
                </div>
            </div>

            <!-- System Info -->
            <div style="margin-top: 24px; padding: 16px; background-color: #f9fafb; border-radius: 6px;">
                <h3 style="margin: 0 0 8px 0; font-weight: 500; color: #1f2937;">
                    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
                </h3>
                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.5;">
                    <div>–°–µ—Ä–≤–∏—Å: {{ health.service }}</div>
                    <div>–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏: {{ health.time | format_datetime }}</div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="loading">
            <div class="spinner"></div>
        </div>
        {% endif %}
    </div>
</div>

<script>
async function checkHealth() {
    const btn = document.getElementById('checkHealthBtn');
    const statusContainer = document.getElementById('healthStatus');
    try {
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner" style="width: 16px; height: 16px;"></span> –ü—Ä–æ–≤–µ—Ä–∫–∞...';
        showLoading(statusContainer);
        await api.get('/health');
        location.reload();
    } catch (error) {
        statusContainer.innerHTML = `
            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 6px;">
                <span style="font-size: 1.25rem;">‚ö†Ô∏è</span>
                <span style="color: #dc2626;">–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã: ${error.message}</span>
            </div>
        `;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span>üîÑ</span> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å';
    }
}
</script>
{% endblock %}